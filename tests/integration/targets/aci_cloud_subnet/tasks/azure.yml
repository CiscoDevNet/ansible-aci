# CLEAN ENVIRONMENT
- name: Set vars
  set_fact: 
    mso_info: &azure_info
      host: '{{ azure_aci_hostname }}'
      username: '{{ azure_aci_username }}'
      password: '{{ azure_aci_password }}'
      validate_certs: '{{ aci_validate_certs | default(false) }}'
      use_ssl: '{{ aci_use_ssl | default(true) }}'
      use_proxy: '{{ aci_use_proxy | default(true) }}'
      output_level: '{{ aci_output_level | default("info") }}'

# - name: Create azure cloud context profile
#   aci_cloud_ctx_profile:
#     <<: *azure_info
#     host: '{{ azure_aci_hostname }}'
#     username: '{{ azure_aci_username }}'
#     password: '{{ azure_aci_password }}'
#     tenant: WoS
#     name: ctx_profile_1
#     vrf: ctx_profile_vrf_1
#     region: westus
#     primary_cidr: '10.10.0.0/16'
#     state: present
#   register: nm_add_azure_ctx_profile

- name: Remove all subnets
  aci_cloud_subnet:
    <<: *azure_info
    host: '{{ azure_aci_hostname }}'
    username: '{{ azure_aci_username }}'
    password: '{{ azure_aci_password }}'
    tenant: WoS
    cloud_context_profile: ctx_profile_1
    cloud_cidr: '10.10.0.0/16'
    address: '{{ item }}'
    state: absent
  loop:
  - 10.10.0.1
  - 10.10.0.2

- name: Create azure cloud subnet (normal_mode)
  aci_cloud_subnet:
    <<: *azure_info
    host: '{{ azure_aci_hostname }}'
    username: '{{ azure_aci_username }}'
    password: '{{ azure_aci_password }}'
    tenant: WoS
    cloud_context_profile: ctx_profile_1
    cloud_cidr: '10.10.0.0/16'
    address: 10.10.0.1
    description: test azure description
  register: nm_add_azure_subnet

- name: Create another azure cloud subnet (normal_mode)
  aci_cloud_subnet:
    <<: *azure_info
    host: '{{ azure_aci_hostname }}'
    username: '{{ azure_aci_username }}'
    password: '{{ azure_aci_password }}'
    tenant: WoS
    cloud_context_profile: ctx_profile_1
    cloud_cidr: '10.10.0.0/16'
    address: 10.10.0.2
  register: nm_add_azure_subnet_2

- name: Query azure cloud subnet
  aci_cloud_subnet:
    <<: *azure_info
    host: '{{ azure_aci_hostname }}'
    username: '{{ azure_aci_username }}'
    password: '{{ azure_aci_password }}'
    tenant: WoS
    cloud_context_profile: ctx_profile_1
    cloud_cidr: '10.10.0.0/16'
    state: query

- name: Query azure cloud subnet
  aci_cloud_subnet:
    <<: *azure_info
    host: '{{ azure_aci_hostname }}'
    username: '{{ azure_aci_username }}'
    password: '{{ azure_aci_password }}'
    tenant: WoS
    cloud_context_profile: ctx_profile_1
    cloud_cidr: '10.10.0.0/16'
    address: 10.10.0.1
    state: query

- name: Remove azure cloud subnet (normal_mode)
  aci_cloud_subnet:
    <<: *azure_info
    host: '{{ azure_aci_hostname }}'
    username: '{{ azure_aci_username }}'
    password: '{{ azure_aci_password }}'
    tenant: WoS
    cloud_context_profile: ctx_profile_1
    cloud_cidr: '10.10.0.0/16'
    address: 10.10.0.1
    state: absent